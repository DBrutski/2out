# На примере денег

## Часть седьмая, заключительная.

Данный синтетический пример далек от реальности, как и все остальные синтетические примеры. J
Вряд ли OrderMoney будет получать позиции на этапе компиляции.
Скорее всего это будет происходить на основе данных, поступающих от других частей приложения.

Но осталась одна проблема.
- [ ] Функция main имеет неприличный размер в 80 строк.

Стоит декомпозировать ее.
Мы можем сделать это, вынеся некоторое количество тестов в отдельный класс.

```c++
class OrderMoneyTest final : public oout::dirty::Test {
public:
	OrderMoneyTest();
};
```

Для этого мы используем oout::dirty::Test, от которого мы можем унаследовать базовое поведение теста. Что удобно, хотя и не очень правильно с точки зрения чистого ООП. Поэтому он находится в dirty.

Все декларации производятся в конструкторе.

```c++
OrderMoneyTest::OrderMoneyTest()
: dirty::Test(
	"OrderMoney tests",
	make_shared<NamedTest>(
		"OrderMoney is sum of all items",
		make_shared<EqualTest>(
			make_shared<MoneyText>(
				make_shared<OrderMoney>(
					make_shared<RealMoney>(5, "USD"),
					make_shared<RealMoney>(7, "USD")
				)
			),
			"12 USD"
		)
	),
	...
)
{
}
```

А в функции main мы просто заменяем группу вынесенных тестов на создание OrderMoneyTest:

```c++
	const SuiteTest tests{
		...,
		make_shared<OrderMoneyTest>()
	};
```

Результаты тестирования теперь содержат внутри себя тестовый набор
```
[==========] Running 6 tests
...
[----------] 4 test from OrderMoney tests
...
[----------] 4 test from OrderMoney tests (0 ms total)
[==========] 6 tests ran.
[  PASSED  ] 6 test.
```

- [x] $5 + 10CHF = $10 если курс обмена 2:1
- [x] $5 * 2 = $10
- [ ] Money это data class
- [ ] Преобразование Money в текст для отчета
- [x] Общая сумма по всем позициям (простой случай)
- [x] Переименовать TimesMoney в OrderItemMoney со всеми вытекающими.
- [x] Заказ из одной позиции
- [x] Заказ из трех и более позиций
- [x] Обмен валют
- [x] Функция main имеет неприличный размер в 80 строк.

Два оставшихся пункта не актуальны.

Код данного примера расположен в каталоге tutorial.
Он собирается и тестируется при каждой сборке.

[Обратная связь](../README.md#contributing) приветствуется.
